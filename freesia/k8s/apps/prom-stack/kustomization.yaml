apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: prom-stack

resources:
- namespace.yaml
- manifests
helmCharts:
# https://github.com/prometheus-community/helm-charts/blob/main/charts/prometheus/values.yaml
- name: prometheus
  releaseName: prometheus
  namespace: prom-stack
  version: 22.6.1
  repo: https://prometheus-community.github.io/helm-charts
  includeCRDs: true
  valuesInline:
    alertmanager:
      enabled: false

    server:
      ## Prometheus server container name
      ##
      enabled: true

      name: server

      ## External URL which can access prometheus
      ## Maybe same with Ingress host name
      baseURL: "https://prom.harvestasya.org"

      extraFlags:
      - web.enable-lifecycle

      ingress:
        ## If true, Prometheus server Ingress will be created
        ##
        enabled: true

        ## Prometheus server Ingress annotations
        ##
        annotations:
          # nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
          # cert-manager.io/cluster-issuer: letsencrypt-prod
        ingressClassName: nginx

        hosts:
        - prom.harvestasya.org

        tls:
        - hosts:
          - prom.harvestasya.org
          # secretName: prometheus-tls

      persistentVolume:
        size: 200Gi

      ## Prometheus data retention period (default if not specified is 15 days)
      ##
      retention: "2y"

    prometheus-pushgateway:
      ## If false, pushgateway will not be installed
      ##
      enabled: false

    extraScrapeConfigs: |
      - job_name: minecraft-dev
        static_configs:
          - targets:
            - freesia.ssa.nw.suzutan.jp:9941
      - job_name: minecraft-prod
        static_configs:
          - targets:
            - freesia.ssa.nw.suzutan.jp:9940
