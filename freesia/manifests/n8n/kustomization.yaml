apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: n8n

resources:
- deployment.yaml
- ingress.yaml
- namespace.yaml
- pvc.yaml
- secret-n8n.yaml
- secret-postgresql.yaml
- service.yaml


configMapGenerator:
- literals:
  - GENERIC_TIMEZONE=Asia/Tokyo
  - N8N_PROTOCOL=http
  - N8N_PORT=5678
  - WEBHOOK_URL=https://reyvateils.harvestasya.org/
  - N8N_PROXY_HOPS=1
  - N8N_HOST=n8n.harvestasya.org
  - N8N_EDITOR_BASE_URL=https://reyvateils.harvestasya.org
  - DB_TYPE=postgresdb
  - DB_POSTGRESDB_HOST=postgresql
  - DB_POSTGRESDB_PORT=5432
  - DB_POSTGRESDB_DATABASE=n8n
  - DB_POSTGRESDB_USER=n8n
  name: n8n-config-env

helmCharts:
- name: postgresql
  releaseName: postgresql
  namespace: n8n
  version: 16.7.27
  repo: oci://registry-1.docker.io/bitnamicharts
  includeCRDs: true
  valuesFile: values-postgresql.yaml
