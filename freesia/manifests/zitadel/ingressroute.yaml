apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: zitadel
  namespace: zitadel
spec:
  entryPoints:
  - websecure
  routes:
  # Login UI v2 - route to login service
  - match: Host(`qualia.harvestasya.org`) && PathPrefix(`/ui/v2/login`)
    kind: Rule
    priority: 20
    services:
    - name: zitadel-login
      port: 3000
      passHostHeader: true
    middlewares:
    - name: security-headers
      namespace: traefik
  # Default - route to zitadel service
  - match: Host(`qualia.harvestasya.org`)
    kind: Rule
    priority: 10
    services:
    - name: zitadel
      port: 8080
      scheme: h2c
      passHostHeader: true
    middlewares:
    - name: security-headers
      namespace: traefik
  tls:
    secretName: harvestasya-wildcard-tls
